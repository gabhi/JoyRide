<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
	<title>Ferraris + WebSockets + WebGL = oMG!</title>
<!-- Add a body and add a title -->
</head>

<body style="margin: 0px; padding: 0px; overflow: hidden; ">
	<script src="./carz_files/tquery-bundle.js"></script>
	<script src="./carz_files/tquery.norequirejs.js"></script>

	<script src="./carz_files/THREEx.KeyboardState.js">	</script>
	<script src="./carz_files/tquery.keyboard.js">	</script>

	<script src="./carz_files/THREEx.DeviceOrientationState.js"></script>
	<script src="./carz_files/tquery.deviceorientation.js"></script>

	<script src="./carz_files/tquery.grassground.js">	</script>
	<script src="./carz_files/tquery.light.shadow.js">	</script>

	<script src="./carz_files/tquery.cubetexture.js"></script>
	<script src="./carz_files/tquery.skymap.js">	</script>

	<script src="./carz_files/Car.js"></script>
	<script src="./carz_files/tquery.car.js"></script>
	<script src="./carz_files/tquery.car.keyboard.js"></script>
	<script src="./carz_files/tquery.car.deviceorientation.js"></script>
	<script src="./carz_files/tquery.car.cameracontrols.js"></script>

	<script src="./carz_files/physi.js"></script>
	<script src="./carz_files/tquery.physijs.js"></script>

	<script>
	document.addEventListener('keydown', function(event){
	    // if it is keydown on a arrow, prevent default
	    if( event.keyCode >= 37 && event.keyCode <= 40 ){
	        event.preventDefault();
	    }
	}, true);
	</script>
	<script>

		var world;

		function init(){
			createWorld();
			createSky();
			createLights();
			createGround();
			createRoad();

			addCar();
		}

		function createWorld(){
			world = tQuery.createWorld().boilerplate().start();
			world.tRenderer().shadowMapEnabled = true;
			world.tRenderer().shadowMapSoft = true;
			world.enablePhysics();
		}

		function createSky(){
			tQuery.createSkymap('skybox').addTo(world);
		}

		function createLights(){
			tQuery.createAmbientLight()
				.addTo(world)
				.color(0xFFFFFF);

			tQuery.createDirectionalLight()
				.addTo(world)
				.position(1,1,-1)
				.color(0xffffff)
				.intensity(2);

			tQuery.createDirectionalLight()
				.addTo(world)
				.position(-10, 20, 30)
				.color(0xffffff)
				.intensity(4)
				.castShadow(true)
				.shadowDarkness(0.8)
				.shadowMap(512*2,512*2)
				.shadowCamera(10, -10, 20, -20, 0.1, 50);
		}
		
		function createGround(){
			var ground	= tQuery.createGrassGround({
				textureUrl	: 'images/grasslight-big.jpg',
				textureRepeatX	: 30,
				textureRepeatY	: 30,		
			}).addTo(world).receiveShadow(true).scaleBy(100);
		}

		function addCar(){
			var car	= tQuery.createCar();
			world.add(car.model());
			tQuery.Car.createCameraControls(car, world);
			world.enablePhysics();

			// var hasTouchEvent	= "ontouchstart" in window;
			// if( hasTouchEvent )	{
			// 	car.hookDeviceOrientation();
			// } else {
				car.hookKeyboard();
			// }
		}

		function createRoad(){
			var material	= new THREE.MeshLambertMaterial({
				ambient	: 0x444444,
				color	: 0x666666,
				envMap	: tQuery.createCubeTexture('skybox')
			});

			for(var i = 0; i < 5; i++){
				tQuery.createTorus(1.25 - 0.25, 0.25, 8, 6 * 4, material)
					.addTo(world)
					.castShadow(true)
					.translateZ( 2 + i * 5 );
			}

		}

		init();
	</script>
</body></html>